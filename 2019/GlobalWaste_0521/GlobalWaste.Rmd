---
title: "GlobaPlasticWaste"
author: "Alyssa Vanderbeek"
date: "5/21/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)
library(countrycode)
library(ggplot2)
library(ggalt)
library(ggthemes)
library(lubridate)
library(viridis)
library(ggpubr)
```

```{r}
coast_vs_waste <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-05-21/coastal-population-vs-mismanaged-plastic.csv") %>%
  janitor::clean_names() %>%
  filter(year == 2010)

mismanaged_vs_gdp <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-05-21/per-capita-mismanaged-plastic-waste-vs-gdp-per-capita.csv") %>%
  purrr::set_names(c("entity", "code", "year", "mismanaged_waste_percap", "gdp_per_capita", "total_pop")) %>%
  filter(year == 2010) %>%
  dplyr::select(entity, mismanaged_waste_percap, gdp_per_capita)

waste_vs_gdp <- readr::read_csv("https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2019/2019-05-21/per-capita-plastic-waste-vs-gdp-per-capita.csv") %>%
  purrr::set_names(c("entity", "code", "year", "per_capita_plastic", "gdp_per_capita", "total_pop")) %>%
  filter(year == 2010) %>%
  dplyr::select(entity, per_capita_plastic)

codes <- codelist %>%
  select(iso3c, country.name.en, region, continent) %>%
  janitor::clean_names() %>%
  filter(!is.na(continent)) %>%
  filter(!is.na(region)) %>%
  left_join(CoordinateCleaner::countryref %>% 
              select(iso3, capital.lon, capital.lat), by = c("iso3c" = "iso3")) %>%
  distinct() %>%
  filter(!is.na(capital.lon)) %>%
  filter(!is.na(capital.lat))

waste <- coast_vs_waste %>%
  left_join(mismanaged_vs_gdp, by = "entity") %>%
  left_join(waste_vs_gdp, by = "entity") %>%
  left_join(codes %>%
              dplyr::select(country_name_en, capital.lon, capital.lat), by = c("entity" = "country_name_en")) %>%
  mutate(entity = recode(entity,
                         "United Kingdom" = "UK",
                         "United States" = "USA",
                         "Trinidad & Tobago" = "Trinidad",
                         "Cote d'Ivoire" = "Ivory Coast",
                         "Democratic Republic of Congo" = "Democratic Republic of the Congo",
                         "Congo" = "Republic of Congo",
                         "Hong Kong" = "China",
                         "British Virgin Islands" = "Virgin Islands",
                         "Saint Vincent and the Grenadines" = "Saint Vincent"))
```


```{r}
world <- ggplot2::map_data("world") %>%
  filter(region != "Antarctica") %>%
  left_join(waste, by = c("region" = "entity"))

world %>%
  mutate(percap_waste_cat = cut(mismanaged_waste_percap,
                                breaks = c(0, 0.01, 0.025, 0.05, 0.10, 0.30))) %>% # create categorical variable that breaks down the mismanaged waste per cap into discrete intervals
  ggplot() + 
  geom_cartogram(
    map = world,
    aes(x = long, y = lat, map_id = region, fill = percap_waste_cat),
    color = "black", size = 0.125
  ) +
  viridis::scale_fill_viridis(discrete = T)  +
  labs(
    x = NULL, y = NULL,
    title = "Mismanaged waste per capita (kg/day)",
    subtitle = "",
    caption = "Source: Our World in Data"
    ) +
  theme_void() +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(plot.subtitle = element_text(hjust = 0.5)) +
  theme(legend.position = "bottom")

```

